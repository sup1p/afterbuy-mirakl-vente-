# Модуль src/const

Этот модуль содержит константные данные и сопоставления атрибутов, необходимые для нормализации и преобразования данных продуктов между платформами Afterbuy и Mirakl. Каждый файл поддерживает перевод атрибутов, проверку значений и многоязычную поддержку.

# constantas_vente:

## - constants.py
Определяет словари и сопоставления для соответствия атрибутов между Mirakl и Afterbuy.
- **mapping_attr:** Основной словарь, сопоставляющий коды атрибутов Mirakl (например, `ATTR_175`) с именами атрибутов Afterbuy или списками возможных имен.
- **NO MAPPING:** Указывает на отсутствующие или неподдерживаемые атрибуты.
- **Использование:** Используется в логике сопоставления для перевода и проверки атрибутов продуктов во время импорта/экспорта.
- **Путь:** `src/const/constants_vente/constants.py`

## - attrs/
Содержит отдельные файлы для атрибутов Mirakl (например, `ATTR_106.py`, `ATTR_175.py`).
- **Формат:** Каждый файл определяет список допустимых значений для атрибута, включая:
  - `code`: Код атрибута Mirakl
  - `label`: Основная метка (обычно на французском)
  - `values`: Список возможных значений, каждое из которых имеет свой код, метку и переводы (немецкий, английский и т.д.)
- **Использование:**
  - Проверяет и нормализует входящие данные продуктов
  - Предоставляет перевод и сопоставление значений для многоязычной поддержки
  - Обеспечивает использование только допустимых значений для импорта в Mirakl
- **Путь:** `src/const/attrs/`

## - Добавление новых:
Если вы нашли ошибки, просто замените ключевые слова или коды, или если хотите добавить дополнительные ключи, измените тип данных с `str` на `list` и добавляйте новые значения.

# constantas_lutz:

## - YAML файлы

Эти YAML файлы определяют сопоставления полей между данными продуктов Afterbuy и схемой целевого маркетплейса (Mirakl).
Сопоставление гарантирует, что атрибуты продуктов корректно передаются и нормализуются во время синхронизации данных.

**Структура:**

- Верхнеуровневые поля: представляют атрибуты продуктов (например, категория, ean, article, pic_main, pics).

- Вложенные свойства.* поля: представляют спецификации или характеристики продуктов.

**Каждая запись указывает либо:**

- Строку → прямое сопоставление с одним полем в целевой схеме.

- Список строк → несколько возможных полей; будет использовано первое непустое значение.

# prompts.py
Этот модуль определяет функции построения промптов, используемые для генерации структурированных запросов к AI-модели (например, OpenAI, через схемы на основе Pydantic-AI).
Цель — создание чистых, готовых для маркетплейса описаний продуктов на нескольких языках на основе сырых данных о продуктах и предложениях.

**Функции**

- `build_description_prompt_vente`:

  - Генерирует промпт, инструктирующий AI вернуть два описания продуктов:

    - `description_de`: Немецкий, ориентирован на сам продукт (дизайн, размеры, материалы, использование, стиль).

    - `description_fr`: Французский, ориентирован на коммерческое предложение (цена, время доставки, гарантия, преимущества для покупателя).

  - Обеспечивает соответствие требованиям маркетплейса: мин/макс количество символов, отсутствие HTML-тегов, отсутствие технического мусора.

  - Входные данные: сырой текст, свойства продукта, название статьи, цена и дни доставки.

- `build_description_prompt_lutz`

  - Аналогичная структура, но выводит:

    - `description_de`: Немецкий, ориентирован на продукт.

    - `description_en`: Английский, ориентирован на предложение.

  - В остальном следует тем же правилам и логике форматирования.

**Общие Правила для Обоих**

- Вывод должен соответствовать фиксированной схеме (description_de, description_fr или description_en).

- Максимальная длина для каждого описания: 2250 символов (настраивается через settings.max_description_chars).

- Правила очистки: удаление HTML, специальных символов, артефактов редактора.

- Стиль написания: плавный, естественный, ориентированный на клиента, без избыточного технического жаргона.

*Использование в Системе*

- Эти функции вызываются перед отправкой запроса к AI.

- Они возвращают хорошо структурированную строку промпта, готовую для передачи модели.

- Полученный от AI результат затем может быть проверен/проанализирован с помощью моделей Pydantic (обеспечивая соответствие схеме).