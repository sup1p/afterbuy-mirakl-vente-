# XXLmebel 1 API

## Описание проекта
XXLmebel 1 API — это backend-приложение на базе FastAPI, предназначенное для автоматизированного переноса больших объемов данных о продуктах с платформы Afterbuy на маркетплейс Mirakl (vente-unique). Сервис обеспечивает интеграцию, трансформацию, экспорт CSV, обработку ошибок и логирование.

## Цель
- Автоматизировать перенос продуктов между Afterbuy и Mirakl
- Генерировать и экспортировать CSV-файлы для импорта
- Проверять ошибки интеграции и отображать статус
- Централизованное логирование операций

## Структура проекта
- `src/` — исходный код приложения
  - `main.py` — точка входа FastAPI
  - `models.py` — модели данных
  - `resources.py` — ресурсы приложения
  - `routers/` — определения маршрутов API
  - `services/` — бизнес-логика и интеграции
  - `core/` — настройки приложения
  - `const/` — константы и атрибуты
  - `crud/` — операции CRUD
  - `schemas/` — схемы данных
  - `utils/` — вспомогательные функции
- `alembic/` — миграции базы данных
- `docs/` — документация API и данных
- `logs/` — конфигурация логирования и файлы логов
- `tests/` — тесты (интеграционные и unit)
- `alembic.ini` — конфигурация Alembic
- `Dockerfile` — файл для сборки Docker-образа
- `entrypoint.sh` — скрипт входа для контейнера
- `pyproject.toml`, `uv.lock` — зависимости и конфигурация сборки
- `.env` — переменные окружения (ключи, пароли)

## Установка и запуск
### Требования
- Python >= 3.11
- Утилита [uv](https://github.com/astral-sh/uv) для управления зависимостями

### Шаги установки
1. Клонируйте репозиторий:
   ```bash
   git clone <repository_url>
   cd xxlmebel_1_api
   ```
2. Создайте и активируйте виртуальное окружение:
   ```bash
   python3.11 -m venv venv
   source venv/bin/activate
   ```
3. Установите зависимости:
   ```bash
   uv sync
   ```
   Или используя PEP 621/pyproject.toml:
   ```bash
   uv pip install .
   ```
4. Скопируйте файл `.env` и укажите необходимые параметры для Afterbuy и Mirakl. Обязательно настройте ключи API, URL платформ, параметры аутентификации и другие переменные окружения, необходимые для интеграции.

5. Добавьте файл fabric_id.json с соответствием ID фабрик.

### Запуск сервера
#### Локальный запуск
```bash
uv run uvicorn src.main:app
```

#### Запуск с Docker Compose
Для запуска в контейнерах используйте Docker Compose. Это обеспечит изоляцию и упростит развертывание.
```bash
docker compose up --build
```
Команда `--build` пересоберет образы, если были изменения в коде или Dockerfile.

## Основные эндпоинты
- `@router.post("/import-products-by-fabric-from-file/vente", tags=["product vente by fabric"])` — Импорт продуктов для vente по fabric_id из локальных файлов.
- `@router.post("/import-products-by-fabric-from-file/xxxlutz", tags=["lutz"])` — Импорт офферов для xxxlutz по fabric_id из локальных данных.

Для интерактивного тестирования API используйте Swagger UI по адресу `http://localhost:8000/docs`.

## Дополнительные замечания
- Все переменные окружения должны быть правильно указаны в файле `.env` перед запуском приложения.
- Для production-развертываний рекомендуется настроить безопасность и контроль доступа.
- Логи операций сохраняются в `logs/logs.log` с включенной ротацией.

## Контакты
По техническим вопросам и поддержке обращайтесь к разработчику проекта.
