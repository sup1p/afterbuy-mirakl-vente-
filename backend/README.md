# XXLmebel 1 API

## Описание проекта
XXLmebel 1 API — это backend-приложение на базе FastAPI, предназначенное для автоматизированного переноса больших объемов данных о продуктах с платформы Afterbuy на маркетплейс Mirakl (vente-unique). Сервис обеспечивает интеграцию, трансформацию, экспорт CSV, обработку ошибок и логирование.

## Цель
- Автоматизировать перенос продуктов между Afterbuy и Mirakl
- Генерировать и экспортировать CSV-файлы для импорта
- Проверять ошибки интеграции и отображать статус
- Централизованное логирование операций

## Структура проекта
- `src/` — исходный код приложения
  - `main.py` — точка входа FastAPI
  - `models.py` — модели данных
  - `resources.py` — ресурсы приложения
  - `routers/` — определения маршрутов API
  - `services/` — бизнес-логика и интеграции
  - `core/` — настройки приложения
  - `const/` — константы и атрибуты
  - `crud/` — операции CRUD
  - `schemas/` — схемы данных
  - `utils/` — вспомогательные функции
- `alembic/` — миграции базы данных
- `docs/` — документация API и данных
- `logs/` — конфигурация логирования и файлы логов
- `tests/` — тесты (интеграционные и unit)
- `alembic.ini` — конфигурация Alembic
- `Dockerfile` — файл для сборки Docker-образа
- `entrypoint.sh` — скрипт входа для контейнера
- `pyproject.toml`, `uv.lock` — зависимости и конфигурация сборки
- `.env` — переменные окружения (ключи, пароли)

## Запуск
### Шаги подготовки
1. Обязательно создайте файл `.env` в папке `/backend/` на основе `.env.example` и укажите необходимые параметры для Afterbuy и Mirakl. Обязательно настройте ключи API, URL платформ, параметры аутентификации и другие переменные окружения, необходимые для интеграции.

2. Создайте файл `.env.local` в корне `/extrup-admin` и пропишите адрес backend API: `NEXT_PUBLIC_API_BASE_URL=http://localhost:8180`

**Примечание:** Если вы хотите изменить имя пользователя и пароль администратора, измените значения в файле `.env` в полях `ADMIN_USERNAME` и `ADMIN_PASSWORD`.

### Запуск с Docker Compose
Для запуска в контейнерах используйте Docker Compose. Это обеспечит изоляцию и упростит развертывание.
```bash
docker compose up --build
```
Команда `--build` пересоберет образы, если были изменения в коде или Dockerfile.

После запуска загрузите необходимые файлы в папку `import_data/` через API endpoints:
- `POST /api/upload-json-fabric-jv` — загрузка JSON файлов для fabrics JV
- `POST /api/upload-json-fabric-xl` — загрузка JSON файлов для fabrics XL
- `POST /api/upload-html-jv` — загрузка HTML файлов для JV
- `POST /api/upload-html-xl` — загрузка HTML файлов для XL

Для просмотра загруженных файлов используйте endpoints для получения списков:
- `GET /api/list-json-fabric-jv?offset=0&limit=10` — список JSON файлов fabrics JV
- `GET /api/list-json-fabric-xl?offset=0&limit=10` — список JSON файлов fabrics XL
- `GET /api/list-html-jv?offset=0&limit=10` — список HTML файлов JV
- `GET /api/list-html-xl?offset=0&limit=10` — список HTML файлов XL

**Важно:** Файлы сохраняются в папку `/backend/src/const/import_data/` на хосте благодаря Docker volume, поэтому данные не теряются при пересборке контейнера.

Только после выполнения всех этих шагов можно работать с приложением.

## Основные эндпоинты
- `@router.post("/import-products-by-fabric-from-file/vente", tags=["product vente by fabric"])` — Импорт продуктов для vente по fabric_id из локальных файлов.
- `@router.post("/import-products-by-fabric-from-file/xxxlutz", tags=["lutz"])` — Импорт офферов для xxxlutz по fabric_id из локальных данных.

Для интерактивного тестирования API используйте Swagger UI по адресу `http://localhost:8180/docs`.

## Дополнительные замечания
- Все переменные окружения должны быть правильно указаны в файле `.env` перед запуском приложения.
- Для production-развертываний рекомендуется настроить безопасность и контроль доступа.
- Логи операций сохраняются в `logs/logs.log` с включенной ротацией.

## Контакты
По техническим вопросам и поддержке обращайтесь к разработчику проекта.
